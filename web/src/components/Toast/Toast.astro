---
import Desktop from "./Desktop.astro";
import Mobile from "./Mobile.astro";

const { data } = Astro.props;
console.log('end', data[0].dateEnd)
const userTimeZoneOffset = new Date().getTimezoneOffset() * 60 * 1000; // User's timezone offset in milliseconds
const currentDate = new Date().getTime() + userTimeZoneOffset; // Current date and time adjusted to user's timezone
console.log("Current Date (Unix timestamp):", currentDate);

const earliestEvent = data
  .filter((event) => {
    const endDate = new Date(event.dateEnd).getTime() + userTimeZoneOffset;
    console.log("Event End Date (Unix timestamp):", endDate);
    // Check if the end date is today or in the future
    return endDate > currentDate;
  })
  .reduce((earliest, current) => {
    if (!earliest) return current; // If there's no earliest event yet, return the current one
    const earliestDate =
      new Date(earliest.dateStart).getTime() + userTimeZoneOffset;
    const currentDate =
      new Date(current.dateStart).getTime() + userTimeZoneOffset;
    return earliestDate < currentDate ? earliest : current;
  }, null); // Initialize the accumulator with null to handle empty arrays

console.log("Earliest Event:", earliestEvent);
---

<div class="toastWrapper">
  {
    earliestEvent != null && (
      <>
        <Desktop data={earliestEvent} />
        <Mobile data={earliestEvent} />
      </>
    )
  }
</div>

<style lang="scss">
  .toastWrapper {
    z-index: 13;
    position: fixed;
    bottom: 2.5vh;
    right: 1vw;
    opacity: 1;
  }

  @media (max-width: 576px) {
    .toastWrapper {
      z-index: 12;
      right: unset;
      left: 50%;
      transform: translateX(-50%);
      bottom: 1rem;
    }
  }
</style>

<script>
  import { inView, animate } from "motion";

  const toast = document.querySelector(".toastWrapper");
  const footer = document.getElementById("footerTrack");
  const upcomingEvents = document.getElementById("upcomingEvents");

  inView(upcomingEvents, () => {
    animate(
      toast,
      {
        opacity: 0,
      },
      {
        duration: 0.35,
      }
    );
    return () => {
      animate(
        toast,
        {
          opacity: 1,
        },
        {
          duration: 0.45,
        }
      );
    };
  });

  inView(footer, () => {
    animate(
      toast,
      {
        opacity: 0,
      },
      {
        duration: 0.35,
      }
    );
    return () => {
      animate(
        toast,
        {
          opacity: 1,
        },
        {
          duration: 0.45,
        }
      );
    };
  });
</script>
